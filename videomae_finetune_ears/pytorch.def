Bootstrap: docker
From: ubuntu:22.04

%post
    export DEBIAN_FRONTEND=noninteractive
    apt-get update && apt-get install -y \
        python3 python3-pip libjpeg-dev zlib1g-dev git

    python3 -m pip install --upgrade pip setuptools wheel

    # Core scientific stack
    pip install numpy pandas scikit-learn matplotlib pillow requests wandb

    # Install PyTorch first
    pip install torch torchvision torchaudio decord

    # Hugging Face ecosystem
    pip install evaluate
    pip install transformers accelerate datasets


%environment
    # Ensure pip-installed binaries are in PATH
    export PATH=/usr/local/bin:$PATH

%test
    python3 --version
    python3 -c "import torch; \
                print('PyTorch:', torch.__version__); \
                print('CUDA available:', torch.cuda.is_available()); \
                print('GPU:', torch.cuda.get_device_name(0) if torch.cuda.is_available() else 'None')"

